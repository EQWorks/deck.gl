{"version":3,"sources":["../../../src/lib/effect-manager.js"],"names":["EffectManager","constructor","effects","_needsRedraw","defaultLightingEffect","LightingEffect","needApplyDefaultLighting","setProps","props","length","setEffects","checkLightingEffect","needsRedraw","opts","clearRedrawFlags","redraw","getEffects","slice","push","finalize","cleanup","effect","hasEffect"],"mappings":";;;;;;;;;AAAA;;AACA;;AAEe,MAAMA,aAAN,CAAoB;AACjCC,EAAAA,WAAW,GAAG;AACZ,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,YAAL,GAAoB,gBAApB;AACA,SAAKC,qBAAL,GAA6B,IAAIC,uBAAJ,EAA7B;AACA,SAAKC,wBAAL,GAAgC,KAAhC;AACD;;AAEDC,EAAAA,QAAQ,CAACC,KAAD,EAAQ;AACd,QAAI,aAAaA,KAAjB,EAAwB;AACtB,UAAIA,KAAK,CAACN,OAAN,CAAcO,MAAd,KAAyB,KAAKP,OAAL,CAAaO,MAAtC,IAAgD,CAAC,0BAAUD,KAAK,CAACN,OAAhB,EAAyB,KAAKA,OAA9B,CAArD,EAA6F;AAC3F,aAAKQ,UAAL,CAAgBF,KAAK,CAACN,OAAtB;AACA,aAAKC,YAAL,GAAoB,iBAApB;AACD;AACF;;AACD,SAAKQ,mBAAL;AACD;;AAEDC,EAAAA,WAAW,GAAmC;AAAA,QAAlCC,IAAkC,uEAA3B;AAACC,MAAAA,gBAAgB,EAAE;AAAnB,KAA2B;AAC5C,UAAMC,MAAM,GAAG,KAAKZ,YAApB;;AACA,QAAIU,IAAI,CAACC,gBAAT,EAA2B;AACzB,WAAKX,YAAL,GAAoB,KAApB;AACD;;AACD,WAAOY,MAAP;AACD;;AAEDC,EAAAA,UAAU,GAAG;AACX,QAAId,OAAO,GAAG,KAAKA,OAAnB;;AACA,QAAI,KAAKI,wBAAT,EAAmC;AACjCJ,MAAAA,OAAO,GAAG,KAAKA,OAAL,CAAae,KAAb,EAAV;AACAf,MAAAA,OAAO,CAACgB,IAAR,CAAa,KAAKd,qBAAlB;AACD;;AACD,WAAOF,OAAP;AACD;;AAEDiB,EAAAA,QAAQ,GAAG;AACT,SAAKC,OAAL;AACD;;AAGDV,EAAAA,UAAU,GAAe;AAAA,QAAdR,OAAc,uEAAJ,EAAI;AACvB,SAAKkB,OAAL;AACA,SAAKlB,OAAL,GAAeA,OAAf;AACD;;AAEDkB,EAAAA,OAAO,GAAG;AACR,SAAK,MAAMC,MAAX,IAAqB,KAAKnB,OAA1B,EAAmC;AACjCmB,MAAAA,MAAM,CAACD,OAAP;AACD;;AACD,SAAKlB,OAAL,CAAaO,MAAb,GAAsB,CAAtB;AACD;;AAEDE,EAAAA,mBAAmB,GAAG;AACpB,QAAIW,SAAS,GAAG,KAAhB;;AACA,SAAK,MAAMD,MAAX,IAAqB,KAAKnB,OAA1B,EAAmC;AACjC,UAAImB,MAAM,YAAYhB,uBAAtB,EAAsC;AACpCiB,QAAAA,SAAS,GAAG,IAAZ;AACA;AACD;AACF;;AACD,SAAKhB,wBAAL,GAAgC,CAACgB,SAAjC;AACD;;AA7DgC","sourcesContent":["import {deepEqual} from '../utils/deep-equal';\nimport {default as LightingEffect} from '../effects/lighting/lighting-effect';\n\nexport default class EffectManager {\n  constructor() {\n    this.effects = [];\n    this._needsRedraw = 'Initial render';\n    this.defaultLightingEffect = new LightingEffect();\n    this.needApplyDefaultLighting = false;\n  }\n\n  setProps(props) {\n    if ('effects' in props) {\n      if (props.effects.length !== this.effects.length || !deepEqual(props.effects, this.effects)) {\n        this.setEffects(props.effects);\n        this._needsRedraw = 'effects changed';\n      }\n    }\n    this.checkLightingEffect();\n  }\n\n  needsRedraw(opts = {clearRedrawFlags: false}) {\n    const redraw = this._needsRedraw;\n    if (opts.clearRedrawFlags) {\n      this._needsRedraw = false;\n    }\n    return redraw;\n  }\n\n  getEffects() {\n    let effects = this.effects;\n    if (this.needApplyDefaultLighting) {\n      effects = this.effects.slice();\n      effects.push(this.defaultLightingEffect);\n    }\n    return effects;\n  }\n\n  finalize() {\n    this.cleanup();\n  }\n\n  // Private\n  setEffects(effects = []) {\n    this.cleanup();\n    this.effects = effects;\n  }\n\n  cleanup() {\n    for (const effect of this.effects) {\n      effect.cleanup();\n    }\n    this.effects.length = 0;\n  }\n\n  checkLightingEffect() {\n    let hasEffect = false;\n    for (const effect of this.effects) {\n      if (effect instanceof LightingEffect) {\n        hasEffect = true;\n        break;\n      }\n    }\n    this.needApplyDefaultLighting = !hasEffect;\n  }\n}\n"],"file":"effect-manager.js"}